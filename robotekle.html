<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Economentor | Robot Ekle</title>
  <link rel="icon" href="image1.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Buradaki stil, mevcut sitenizin stiline uyumlu olacak şekilde ayarlanabilir */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f1f1f1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      color: #333;
    }

    header {
      background-color: #4CAF50;
      color: white;
      padding: 20px 0;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    header h1 {
      margin: 0;
      font-size: 36px;
      letter-spacing: 2px;
    }

    /* Navigation Menu */
    nav {
      display: flex;
      justify-content: space-around;
      background-color: #333;
      padding: 15px 0;
    }

    nav a {
      text-decoration: none;
      color: white;
      font-weight: bold;
      font-size: 16px;
      padding: 10px;
      transition: background 0.3s ease;
    }

    nav a:hover {
      background-color: #4CAF50;
    }

    .content {
      flex-grow: 1;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .upload-section {
      width: 80%;
      background-color: #fff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .upload-section input[type="file"],
    .upload-section input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .upload-section button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }

    .upload-section button:hover {
      background-color: #45a049;
    }

    .user-list {
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
    }

    .user-list li {
      padding: 8px;
      border: 1px solid #ccc;
      margin-bottom: 8px;
      cursor: pointer;
      background-color: #f9f9f9;
      border-radius: 5px;
    }

    .user-list li:hover {
      background-color: #e0e0e0;
    }

    .footer {
      background-color: #333;
      color: white;
      padding: 10px;
      text-align: center;
      position: relative;
      bottom: 0;
      width: 100%;
    }

    .shared-files {
      margin-top: 40px;
      width: 80%;
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .shared-files h3 {
      text-align: center;
      margin-bottom: 20px;
    }

    .shared-files ul {
      list-style-type: none;
      padding: 0;
    }

    .shared-files li {
      padding: 10px;
      border: 1px solid #ddd;
      margin-bottom: 10px;
      background-color: #f9f9f9;
      border-radius: 5px;
    }

    .shared-files li button {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 14px;
      border-radius: 5px;
      float: right;
    }

    .shared-files li button:hover {
      background-color: #c0392b;
    }

#publishedRobotsList li {
  padding: 10px;
  border: 1px solid #ddd;
  margin-bottom: 10px;
  background-color: #f9f9f9;
  border-radius: 5px;
  position: relative;
}

#publishedRobotsList li button {
  background-color: #4CAF50;
  color: white;
  border: none;
  padding: 5px 10px;
  cursor: pointer;
  font-size: 14px;
  border-radius: 5px;
  margin-left: 5px;
}

#publishedRobotsList li button.delete {
  background-color: #e74c3c;
}

#publishedRobotsList li button.delete:hover {
  background-color: #c0392b;
}

#publishedRobotsList li button:hover {
  opacity: 0.9;
}

/* Açıklama satır atlamalarını koru */
#publishedRobotsList li .description {
  white-space: pre-wrap;
  margin-top: 5px;
  display: block;
}

#publishedRobotsDropdown {
  border: 1px solid #ccc;
  max-height: 150px;
  overflow-y: auto;
  overflow-x: hidden;
  position: absolute;
  background: #fff;
  width: 100%;
  top: 100%; /* input’un altına yerleştir */
  left: 0;
  margin-top: 4px;
  padding-left: 0;
  list-style: none;
  display: none;
  z-index: 999;
  box-sizing: border-box;
  font-size: 14px;
  white-space: nowrap;
}

#publishedRobotsDropdown li {
  padding: 8px;
  cursor: pointer;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.shared-files, .upload-section {
  margin-bottom: 100px; /* İki blok arasına boşluk koyar */
}

  </style>
</head>
<body>

  <header>
    <h1>Economentor | Robot Ekle</h1>
  </header>

  <nav>
    <a href="adminpanel.html">Yönetici Paneli</a> <!-- Yönetici Paneline Yönlendiren Link -->
    <a href="robot.html">Robot Sayfası</a>
  </nav>

<div class="content">

<!-- Robot Yayınla Bölümü -->
<div class="upload-section" style="width: 100%; max-width: 700px;">
  <h2>Robot Yayınla</h2>
  <input type="text" id="robotTitle" placeholder="Robot Adı" />
  <textarea id="robotDescription" placeholder="Açıklama" rows="4" style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
  <button id="publishRobotButton">Yayınla</button>
</div>

  <!-- Yayınlanmış Robotlar -->
  <div class="shared-files">
    <h3>Yayınlanmış Robotlar</h3>
    <ul id="publishedRobotsList"></ul>
  </div>

<!-- Yeni Robot Paylaş Bölümü -->
<div class="upload-section" style="width: 100%; max-width: 700px;">
  <h2>Yeni Robot Paylaş</h2>
  <input type="file" id="fileUpload" accept=".rar" />

  <!-- Yayınlanmış Robot Seçiniz Dropdown -->
  <div style="position: relative; width: 100%; margin-bottom: 15px;">
    <input type="text" id="fileNameInput" placeholder="Yayınlanmış Robot Seçiniz" autocomplete="off" style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 5px;" />
    <ul id="publishedRobotsDropdown" style="
        border: 1px solid #ccc;
        max-height: 150px;
        overflow-y: auto;
        overflow-x: hidden;
        position: absolute;
        background: #fff;
        width: 100%;
        top: 100%;
        left: 0;
        margin-top: 4px;
        padding-left: 0;
        list-style: none;
        display: none;
        z-index: 999;
        box-sizing: border-box;
        font-size: 14px;
        white-space: nowrap;
      ">
    </ul>
  </div>

  <!-- Kullanıcı Arama -->
  <input type="text" id="searchInput" placeholder="Kullanıcı Adı Ara" style="margin-bottom: 10px;" />
  <ul id="userList" class="user-list"></ul>

  <!-- Seçilen Kullanıcılar -->
  <h3>Seçilen Kullanıcılar:</h3>
  <ul id="selectedUserList"></ul>

  <button id="uploadButton">Paylaş</button>
</div>

  <!-- Geçmişte Paylaşılan Robot Dosyaları -->
  <div class="shared-files">
    <h3>Geçmişte Paylaşılan Robot Dosyaları</h3>
    <ul id="sharedFilesList"></ul>
  </div>

</div>

<!-- Footer -->
<div class="footer">
  <p>© 2025 Economentor. Tüm Hakları Saklıdır.</p>
</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, setDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.10.0/+esm';
    import { getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";


    const firebaseConfig = {
      apiKey: "AIzaSyADPBpJhZ9UKR1NFC42bqEqgKHyLaWunIQ",
      authDomain: "economentor-8ddc4.firebaseapp.com",
      projectId: "economentor-8ddc4",
      storageBucket: "economentor-8ddc4.firebasestorage.app",
      messagingSenderId: "835370350520",
      appId: "1:835370350520:web:d9bb275eb4b7502997814d",
      measurementId: "G-FS3FMPYVPD"
    };

    const supabaseUrl = "https://rvwsvhgihatxxhnbmouw.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ2d3N2aGdpaGF0eHhobmJtb3V3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM2MTYxNTAsImV4cCI6MjA1OTE5MjE1MH0.91XCg6CE4WfI6Rr4K5vIOJB5-fi5QW8SZ98LngMLJMI";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const supabase = createClient(supabaseUrl, supabaseKey);

    // Arama ve kullanıcı listeleme
    document.getElementById("searchInput").addEventListener("input", searchUsers);

// Dosya yükleme işlemi
document.getElementById("uploadButton").addEventListener("click", async function() {
  const file = document.getElementById("fileUpload").files[0];
  const customName = document.getElementById("fileNameInput").value.trim();
  
  if (!customName) {
    alert("Lütfen bir dosya adı girin.");
    return;
  }

  // Dosya seçilmemişse hata göster
  if (!file) {
    alert("Lütfen bir dosya seçin.");
    return;
  }

  // Seçilen kullanıcılar yoksa hata göster
  if (selectedUsers.length === 0) {
    alert("Lütfen en az bir kullanıcı seçin.");
    return;
  }

  try {
    // Dosya adı oluştur
    const fileName = `${Date.now()}-${file.name}`;
    const safeFileName = sanitizeFilename(fileName);  // Dosya adını temizle

    // Supabase'e dosya yükle
    const { error } = await supabase.storage.from('robotlar').upload(safeFileName, file);

    if (error) {
      console.error("Supabase yükleme hatası:", error);
      throw new Error(`Dosya yüklenemedi: ${error.message}`);
    }

    // Dosya URL'ini al
    const fileUrl = `${supabaseUrl}/storage/v1/object/public/robotlar/${safeFileName}`;
    console.log("Dosya URL'si: ", fileUrl);  // Dosya URL'sini kontrol et

    // Seçilen kullanıcılar
    console.log("Seçilen Kullanıcılar (UID):", selectedUsers.map(user => user ? user.uid : 'undefined'));  // Seçilen kullanıcıları kontrol et

    // Paylaşılan dosya kaydını Firestore'a ekleyelim
    const fileData = {
      fileUrl: fileUrl,
      sharedWith: selectedUsers.map(user => user.uid),
      timestamp: new Date(),
      robotId: selectedRobot?.id || null,
      robotTitle: selectedRobot?.title || null
    };

    function clearUploadForm() {
      document.getElementById("fileUpload").value = "";
      document.getElementById("fileNameInput").value = "";
      document.getElementById("searchInput").value = "";
      selectedUsers = [];
      updateSelectedUserList();
      searchUsers(); // Listeyi sıfırla ve tekrar yükle
    }
    console.log("File Data:", fileData);  // FileData'nın doğru olduğunu kontrol et

    // Eksik veri kontrolü
    if (!fileData.fileUrl || !fileData.sharedWith || fileData.sharedWith.length === 0) {
      throw new Error("Eksik veri: Dosya URL'si veya paylaşılacak kullanıcılar eksik.");
    }

    if (!selectedRobot) {
      alert("Lütfen paylaşmak istediğiniz robotu seçin.");
      return;
    }

    // Veriyi Firestore'a kaydedelim
    await setDoc(doc(db, "uploadedFiles", safeFileName), fileData);

    alert("Dosya başarıyla yüklendi ve kullanıcılara bildirildi!");
    loadSharedFiles(); // Yüklenen dosyaları tekrar yükle
    clearUploadForm();

  } catch (err) {
    console.error("Dosya yüklenirken hata:", err);
    alert(`Dosya yüklenirken bir hata oluştu: ${err.message}`);
  }
});

async function searchUsers() {
  const searchTerm = document.getElementById("searchInput").value.toLowerCase();
  const usersSnap = await getDocs(collection(db, "users"));
  const userList = document.getElementById("userList");

  userList.innerHTML = ""; // Eski listeyi temizliyoruz

  usersSnap.forEach((userDoc) => {
    const userData = userDoc.data();  // Kullanıcı verisini alıyoruz
    const fullName = userData.fullName || '';  // Kullanıcı ismini alıyoruz

    console.log("userData:", userData);  // Burada userData'yı log'layarak kontrol ediyoruz
    console.log("userData.uid:", userData.uid);  // Burada userData.uid'yi loglayarak kontrol ediyoruz

    // Kullanıcı adı ile arama yapıyoruz
    if (fullName.toLowerCase().includes(searchTerm)) {
      const listItem = document.createElement("li");
      listItem.textContent = fullName;  // Kullanıcı adını listeye ekliyoruz
      listItem.onclick = () => selectUser(userDoc.id); // Kullanıcıyı uid'si ile seçiyoruz
      userList.appendChild(listItem); // Listeye ekliyoruz
    }
  });
}

let selectedUsers = [];

async function selectUser(uid) {
  console.log("Seçilen Kullanıcı ID:", uid);  // Kullanıcı ID'sini log'la

  const userRef = doc(db, "users", uid);
  try {
    const docSnap = await getDoc(userRef);
    if (docSnap.exists()) {
      const userData = docSnap.data();
      userData.uid = uid;  // UID'yi ekle!

      if (!selectedUsers.find(u => u.uid === uid)) {
        selectedUsers.push(userData);
        console.log("Seçilen Kullanıcılar (UID):", selectedUsers.map(user => user.uid));
        updateSelectedUserList();
      }
    } else {
      console.log("Kullanıcı bulunamadı!");
    }
  } catch (error) {
    console.error("Kullanıcı bilgisi alınırken hata:", error);
  }
}

// Function to update the list of selected users on the UI
function updateSelectedUserList() {
  const selectedUserList = document.getElementById("selectedUserList");
  selectedUserList.innerHTML = "";  // Clear the current list

  selectedUsers.forEach((user, index) => {
    const listItem = document.createElement("li");
    listItem.textContent = user.fullName;
    const removeButton = document.createElement("button");
    removeButton.textContent = "Sil";
    removeButton.onclick = () => removeUser(index);  // Remove user from selected list
    listItem.appendChild(removeButton);
    selectedUserList.appendChild(listItem);
  });
}

// Function to remove a user from the selected list
function removeUser(index) {
  selectedUsers.splice(index, 1);  // Remove the user at the given index
  updateSelectedUserList();  // Update the displayed list
}

// sanitizeFilename fonksiyonu
function sanitizeFilename(filename) {
  return filename
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "") // aksanlı harfleri kaldır
    .replace(/[^a-zA-Z0-9_.-]/g, ""); // sadece geçerli karakterler
}

async function loadSharedFiles() {
  const sharedFilesList = document.getElementById("sharedFilesList");
  sharedFilesList.innerHTML = ""; // Önceki listeleri temizle

  const sharedFilesSnap = await getDocs(collection(db, "uploadedFiles"));
  for (const docSnap of sharedFilesSnap.docs) {
    const sharedFile = docSnap.data();

    const listItem = document.createElement("li");
    const fileUrl = sharedFile.fileUrl;
    const sharedWith = sharedFile.sharedWith || [];

    // UID'leri isimlere dönüştür
    const userNames = [];
    for (const uid of sharedWith) {
      const userRef = doc(db, "users", uid);
      const userSnap = await getDoc(userRef);
      if (userSnap.exists()) {
        const data = userSnap.data();
        userNames.push(data.fullName || uid);
      } else {
        userNames.push(uid);
      }
    }

    listItem.innerHTML = `
      <strong>Dosya:</strong> <a href="${fileUrl}" target="_blank">${fileUrl.split("/").pop()}</a><br>
      <strong>Paylaşılan Kullanıcılar:</strong> ${userNames.join(", ")}
    `;

    const removeButton = document.createElement("button");
    removeButton.textContent = "Sil";
    removeButton.onclick = () => deleteSharedFile(docSnap.id);
    listItem.appendChild(removeButton);

    sharedFilesList.appendChild(listItem);
  }
}

async function deleteSharedFile(fileId) {
  try {
    // Firestore'dan dosya verisini al
    const docRef = doc(db, "uploadedFiles", fileId);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const fileData = docSnap.data();
      const fileUrl = fileData.fileUrl;

      // Supabase Storage için dosya adını çıkar (URL'deki son parça)
      const fileName = fileUrl.split('/').pop();

      // Supabase'den sil
      const { error: supabaseError } = await supabase.storage.from('robotlar').remove([fileName]);
      if (supabaseError) {
        console.warn("Supabase dosya silme hatası:", supabaseError.message);
      }

      // Firestore'dan sil
      await deleteDoc(docRef);

      // Listeyi yenile
      loadSharedFiles();

    } else {
      console.log("Silinecek dosya Firestore'da bulunamadı.");
    }
  } catch (error) {
    console.error("Dosya silinirken hata oluştu:", error);
  }
}

document.getElementById("publishRobotButton").addEventListener("click", async () => {
  const title = document.getElementById("robotTitle").value.trim();
  const description = document.getElementById("robotDescription").value.trim();

  if (!title || !description) {
    alert("Lütfen robot adı ve açıklama girin.");
    return;
  }

  const robotData = {
    title,
    description,
    timestamp: new Date()
  };

  try {
    const id = `robot-${Date.now()}`;
await setDoc(doc(db, "publishedRobots", id), robotData);
alert("Robot başarıyla yayınlandı!");
document.getElementById("robotTitle").value = "";
document.getElementById("robotDescription").value = "";
loadPublishedRobots();
fetchPublishedRobotsForSelection()
  } catch (error) {
    console.error("Robot yayınlama hatası:", error);
    alert("Yayınlanırken bir hata oluştu: " + error.message);
  }
});

let editingId = null; // Düzenlenen robotun id'si
    
async function loadPublishedRobots() {
  const list = document.getElementById("publishedRobotsList");
  list.innerHTML = "";

  try {
    const snap = await getDocs(collection(db, "publishedRobots"));
    const robots = snap.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));

    // Tarihe göre sıralama (Firestore Timestamp veya Date objesi olabilir)
    robots.sort((a, b) => {
      const aTime = a.timestamp?.toDate ? a.timestamp.toDate().getTime() : new Date(a.timestamp).getTime();
      const bTime = b.timestamp?.toDate ? b.timestamp.toDate().getTime() : new Date(b.timestamp).getTime();
      return bTime - aTime;
    });

    for (const robot of robots) {
      const li = document.createElement("li");

      if (editingId === robot.id) {
        // Düzenleme modu
        li.innerHTML = `
          <input id="editTitle" type="text" value="${robot.title}" style="width: 100%; padding: 5px; font-size: 16px;" />
          <textarea id="editDescription" style="width: 100%; padding: 5px; font-size: 16px; margin-top: 5px;" rows="4">${robot.description}</textarea>
          <button id="saveBtn">Kaydet</button>
          <button id="cancelBtn">İptal</button>
        `;

        li.querySelector("#saveBtn").onclick = async () => {
          const newTitle = li.querySelector("#editTitle").value.trim();
          const newDesc = li.querySelector("#editDescription").value.trim();
          if (!newTitle || !newDesc) {
            alert("Lütfen başlık ve açıklama girin.");
            return;
          }
          try {
            await updateDoc(doc(db, "publishedRobots", robot.id), {
              title: newTitle,
              description: newDesc,
              timestamp: new Date()
            });
            editingId = null;
            loadPublishedRobots();
            fetchPublishedRobotsForSelection()
          } catch (error) {
            console.error("Robot güncellenirken hata:", error);
            alert("Güncellenirken hata oluştu.");
          }
        };

        li.querySelector("#cancelBtn").onclick = () => {
          editingId = null;
          loadPublishedRobots();
          fetchPublishedRobotsForSelection()
        };

      } else {
        // Normal gösterim
        li.innerHTML = `
          <strong>${robot.title}</strong>
          <span class="description">${robot.description.replace(/\n/g, "<br>")}</span>
          <button class="editBtn">Düzenle</button>
          <button class="delete deleteBtn">Sil</button>
        `;
        li.querySelector(".editBtn").onclick = () => {
          editingId = robot.id;
          loadPublishedRobots();
          fetchPublishedRobotsForSelection()
        };
        li.querySelector(".deleteBtn").onclick = async () => {
          if (confirm("Bu robotu silmek istediğinizden emin misiniz?")) {
            try {
              await deleteDoc(doc(db, "publishedRobots", robot.id));
              loadPublishedRobots();
              fetchPublishedRobotsForSelection()
            } catch (error) {
              console.error("Robot silinirken hata:", error);
              alert("Silme işlemi sırasında hata oluştu.");
            }
          }
        };
      }

      list.appendChild(li);
    }
  } catch (error) {
    console.error("Yayınlanmış robotlar yüklenirken hata:", error);
  }
}

let publishedRobots = []; // Yayınlanmış robotları burada tutacağız
let selectedRobot = null; // Seçilen robot objesi

async function fetchPublishedRobotsForSelection() {
  try {
    const snap = await getDocs(collection(db, "publishedRobots"));
    publishedRobots = snap.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));

    // Basitçe input altına listeyi gösterelim
    showPublishedRobotOptions();
  } catch (error) {
    console.error("Yayınlanmış robotlar alınırken hata:", error);
  }
}

const fileNameInput = document.getElementById("fileNameInput");
const publishedRobotsDropdown = document.getElementById("publishedRobotsDropdown");

function showPublishedRobotOptions() {
  publishedRobotsDropdown.innerHTML = "";
  if (publishedRobots.length === 0) {
    publishedRobotsDropdown.style.display = "none";
    return;
  }

  publishedRobots.forEach(robot => {
    const li = document.createElement("li");
    li.textContent = robot.title;
    li.style.padding = "8px";
    li.style.cursor = "pointer";

    li.onclick = () => {
      fileNameInput.value = robot.title;
      selectedRobot = robot; // Seçilen robotu kaydet
      publishedRobotsDropdown.style.display = "none";
    };

    publishedRobotsDropdown.appendChild(li);
  });

  publishedRobotsDropdown.style.display = "block";
}

// Input'a yazarken filtreleme için
fileNameInput.addEventListener("click", () => {
  if (publishedRobots.length > 0) {
    showPublishedRobotOptions();
  }

  const val = fileNameInput.value.toLowerCase();
  publishedRobotsDropdown.innerHTML = "";
  const filtered = publishedRobots.filter(r => r.title.toLowerCase().includes(val));

  if (filtered.length === 0) {
    publishedRobotsDropdown.style.display = "none";
    selectedRobot = null;
    return;
  }

  filtered.forEach(robot => {
    const li = document.createElement("li");
    li.textContent = robot.title;
    li.style.padding = "8px";
    li.style.cursor = "pointer";
    li.onclick = () => {
      fileNameInput.value = robot.title;
      selectedRobot = robot;
      publishedRobotsDropdown.style.display = "none";
    };
    publishedRobotsDropdown.appendChild(li);
  });

  publishedRobotsDropdown.style.display = "block";
});
;

document.addEventListener("click", (event) => {
  // Eğer tıklama fileNameInput veya dropdown dışında ise dropdown kapansın
  if (
    event.target !== fileNameInput &&
    !publishedRobotsDropdown.contains(event.target)
  ) {
    publishedRobotsDropdown.style.display = "none";
  }
});
    
// Sayfa yüklendiğinde geçmişte paylaşılan dosyaları yükleyelim
loadPublishedRobots()
fetchPublishedRobotsForSelection();
loadSharedFiles();
searchUsers();
    
</script>
<script type="module" src="auth-guard.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Economentor | Paylaşım</title>
  <link rel="icon" href="image1.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  /* Genel Tasarım */
  body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f1f1f1;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    color: #333;
  }

  header {
    background-color: #4CAF50;
    color: white;
    padding: 20px 0;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  }

  header h1 {
    margin: 0;
    font-size: 36px;
  }

  nav {
    display: flex;
    justify-content: space-around;
    background-color: #333;
    padding: 15px 0;
  }

  nav a {
    text-decoration: none;
    color: white;
    font-weight: bold;
    font-size: 16px;
    padding: 10px;
  }

  .footer {
    background-color: #333;
    color: white;
    padding: 10px;
    text-align: center;
    position: relative;
    bottom: 0;
    width: 100%;
  }

  /* Form Container */
  .form-container {
    padding: 20px;
    background: #fff;
    margin: 20px auto;
    max-width: 500px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  }

  .form-container input, .form-container textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 5px;
    border: 1px solid #ddd;
  }

  .form-container button {
    width: 100%;
    padding: 10px;
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 5px;
  }

  .form-container button:hover {
    background-color: #45a049;
  }

  /* Paylaşılan Dosya ve Robot Listesi */
  .file-list, .robot-list {
    margin-top: 20px;
    padding: 10px;
    background: #f9f9f9;
    border-radius: 5px;
    border: 1px solid #ddd;
  }

  .list-item {
    margin: 5px 0;
    padding: 8px;
    background: #e0e0e0;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
  }
  
  .list-item button {
    background-color: #f44336;
    color: white;
    border: none;
    padding: 5px;
    cursor: pointer;
  }

  .list-item button:hover {
    background-color: #d32f2f;
  }

  /* Mobil uyumluluk */
  @media (max-width: 768px) {
    .form-container {
      max-width: 100%;
      padding: 10px;
    }

    nav {
      flex-direction: column;
    }

    .footer {
      position: static;
    }
  }
</style>
</head>
<body>

  <header>
    <h1>Economentor | Paylaşım</h1>
  </header>

  <nav>
    <a href="adminpanel.html">Yönetici Paneli</a>
    <a href="robot.html">Robot Sayfası</a>
  </nav>

  <!-- Dosya Paylaşım Formu -->
  <div class="form-container">
    <h2>RAR Dosyası Paylaş</h2>
    <input type="file" id="fileInput" />
    <select id="userSelect" multiple>
      <!-- Kişiler Burada Gösterilecek -->
    </select>
    <button onclick="shareFile()">Dosya Paylaş</button>
  </div>

  <!-- Paylaşılan Dosyalar -->
  <div class="file-list">
    <h3>Paylaşılan Dosyalar</h3>
    <div id="sharedFiles"></div>
  </div>

  <!-- Robot Paylaşım Formu -->
  <div class="form-container">
    <h2>Robot Paylaş</h2>
    <input type="text" id="robotName" placeholder="Robot Adı" />
    <textarea id="robotDesc" placeholder="Robot Açıklaması"></textarea>
    <button onclick="shareRobot()">Robot Paylaş</button>
  </div>

  <!-- Paylaşılan Robotlar -->
  <div class="robot-list">
    <h3>Paylaşılan Robotlar</h3>
    <div id="sharedRobots"></div>
  </div>

  <div class="footer">
    <p>© 2025 Economentor. Tüm Hakları Saklıdır.</p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, getDocs, setDoc, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.10.0/+esm';

    const firebaseConfig = {
      apiKey: "AIzaSyADPBpJhZ9UKR1NFC42bqEqgKHyLaWunIQ",
      authDomain: "economentor-8ddc4.firebaseapp.com",
      projectId: "economentor-8ddc4",
      storageBucket: "economentor-8ddc4.firebasestorage.app",
      messagingSenderId: "835370350520",
      appId: "1:835370350520:web:d9bb275eb4b7502997814d",
      measurementId: "G-FS3FMPYVPD"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

async function shareFile() {
  const file = document.getElementById('fileInput').files[0];
  const userSelect = document.getElementById('userSelect');
  const selectedUsers = Array.from(userSelect.selectedOptions).map(option => option.value);
  
  // Firebase Storage'da dosya yükleme
  const storageRef = firebase.storage().ref('uploads/' + file.name);
  await storageRef.put(file);
  const fileURL = await storageRef.getDownloadURL();

  // Firestore'a dosya bilgisi ekleme
  selectedUsers.forEach(async (user) => {
    const fileShareRef = collection(db, 'file_shares');
    await setDoc(doc(fileShareRef), {
      file_name: file.name,
      file_url: fileURL,
      from_user: 'currentUser',  // Burada dinamik bir kullanıcı bilgisi ekleyebilirsiniz
      to_user: user,
      timestamp: new Date()
    });
  });

  loadSharedFiles();  // Paylaşılan dosyaları yeniden yükle
}


    // Paylaşılan Dosyaları Yükle
    async function loadSharedFiles() {
      const sharedFilesContainer = document.getElementById('sharedFiles');
      sharedFilesContainer.innerHTML = '';  // Önceki içerikleri temizle
      const querySnapshot = await getDocs(collection(db, 'file_shares'));
      querySnapshot.forEach(doc => {
        const file = doc.data();
        const div = document.createElement('div');
        div.classList.add('list-item');
        div.innerHTML = `
          <span>${file.file_name} (${file.to_user})</span>
          <button onclick="deleteSharedFile('${doc.id}')">Sil</button>
        `;
        sharedFilesContainer.appendChild(div);
      });
    }

    // Paylaşılan Dosyayı Sil
    async function deleteSharedFile(id) {
      await deleteDoc(doc(db, 'file_shares', id));
      loadSharedFiles();  // Dosya silindikten sonra yeniden yükle
    }

    // Robot Paylaşımı
    async function shareRobot() {
      const robotName = document.getElementById('robotName').value;
      const robotDesc = document.getElementById('robotDesc').value;

      const robotRef = collection(db, 'robots');
      await setDoc(doc(robotRef), {
        name: robotName,
        description: robotDesc,
        timestamp: new Date()
      });

      loadSharedRobots();  // Paylaşılan robotları yükle
    }

    // Paylaşılan Robotları Yükle
    async function loadSharedRobots() {
      const sharedRobotsContainer = document.getElementById('sharedRobots');
      sharedRobotsContainer.innerHTML = '';  // Önceki içerikleri temizle
      const querySnapshot = await getDocs(collection(db, 'robots'));
      querySnapshot.forEach(doc => {
        const robot = doc.data();
        const div = document.createElement('div');
        div.classList.add('list-item');
        div.innerHTML = `
          <span>${robot.name}: ${robot.description}</span>
          <button onclick="deleteSharedRobot('${doc.id}')">Sil</button>
        `;
        sharedRobotsContainer.appendChild(div);
      });
    }

    // Paylaşılan Robotu Sil
    async function deleteSharedRobot(id) {
      await deleteDoc(doc(db, 'robots', id));
      loadSharedRobots();  // Robot silindikten sonra yeniden yükle
    }

    // Sayfa yüklendiğinde paylaşılan dosyaları ve robotları yükle
    window.onload = () => {
      loadSharedFiles();
      loadSharedRobots();
    }
  </script>

</body>
</html>

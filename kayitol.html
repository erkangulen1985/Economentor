<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Economentor | Kayıt Ol</title>
  <link rel="icon" type="image/png" href="image1.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0; padding: 0;
      background-color: #001f3d;
      color: #fff;
      font-family: Arial, sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .background {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
      z-index: -1;
      background: url('image2.png') center/cover no-repeat fixed;
    }

    .container {
      background: rgba(0, 0, 0, 0.7);
      padding: 30px;
      border-radius: 12px;
      width: 100%; max-width: 400px;
      box-shadow: 0 0 10px rgba(255,255,255,0.2);
    }

    h2 { margin-bottom: 20px; font-size: 26px; }

    input, button {
      width: 100%;
      padding: 12px; margin: 10px 0;
      border-radius: 6px; border: none;
      font-size: 16px;
    }

    input { background: #2a2a2a; color: white; }

    button {
      background: linear-gradient(to right, #6a11cb, #2575fc);
      color: white; font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background: linear-gradient(to right, #ffcc70, #6a11cb);
    }

#errorMsg {
  color: #fff;
  background: rgba(255, 0, 0, 0.3); /* kırmızı arka plan */
  padding: 8px;
  border-radius: 6px;
  margin-bottom: 10px;
  font-size: 0.9em;
  display: none;
}

#successMsg {
  color: #fff;
  background: rgba(0, 255, 0, 0.2); /* yeşil arka plan */
  padding: 8px;
  border-radius: 6px;
  margin-bottom: 10px;
  font-size: 0.9em;
  display: none;
}

    label {
      display: block;
      text-align: left;
      margin-top: 10px;
      margin-bottom: 5px;
      font-size: 0.9em;
      font-weight: bold;
    }

    .link {
      color: #fff;
      text-decoration: none;
      margin-top: 10px;
      font-size: 14px;
      display: block;
    }

    .link:hover { text-decoration: underline; }

    /* Modal */
    #warningModal {
      display: none;
      position: fixed;
      z-index: 9999;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
    }

    #warningModal .modal-content {
      background: white; color: black;
      padding: 20px;
      border-radius: 10px;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      text-align: left;
      font-size: 14px;
      line-height: 1.5;
    }

    #warningModal h3 {
      margin-top: 0;
    }

    #warningModal .modal-buttons {
      text-align: right;
      margin-top: 20px;
    }

    #warningModal button {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      margin-left: 10px;
    }

    #cancelModalBtn { background: #ccc; color: #000; }
    #acceptModalBtn { background: #007bff; color: #fff; }

    @media (max-width: 480px) {
      body { flex-direction: column; justify-content: flex-start; padding: 40px 10px; }
      .container { padding: 20px; }
      h2 { font-size: 22px; }
      input, button { padding: 10px; font-size: 15px; }
      label { font-size: 0.85em; }
    }
  </style>
</head>
<body>

  <div class="background"></div>

  <div class="container">
    <h2>Kayıt Ol</h2>
    <form id="registerForm">
      <div id="errorMsg"></div>
      <div id="successMsg"></div>
      <label for="dob">Doğum Tarihi</label>
      <input type="date" id="dob" required>
      <label for="fullName">Ad Soyad</label>
      <input type="text" id="fullName" placeholder="Ad Soyad" required>
      <label for="username">Kullanıcı Adı</label>
      <input type="text" id="username" placeholder="Kullanıcı Adı" required>
      <label for="email">E-Posta</label>
      <input type="email" id="email" placeholder="E-Posta" required>
<label for="password">Şifre</label>
<div style="position: relative;">
  <input type="password" id="password" placeholder="Şifre" required style="padding-right: 40px;">
  <i id="togglePassword" class="fa-solid fa-eye-slash"
     style="position: absolute; top: 50%; right: 10px; transform: translateY(-50%);
            cursor: pointer; color: white; padding: 4px; border-radius: 50%;">
  </i>
</div>

<label for="confirmPassword">Şifre Tekrar</label>
<input type="password" id="confirmPassword" placeholder="Şifre Tekrar" required>
      <button type="submit" id="registerBtn">Kayıt Ol</button>
      <a href="index.html" class="link">Giriş Yap</a>
    </form>
  </div>


  <!-- Modal -->
  <div id="warningModal">
    <div class="modal-content">
      <h3>Yatırım Bilgilendirme ve Kullanım Koşulları</h3>
      <p>Bu sitede yer alan yatırım bilgi, yorum ve tavsiyeleri <strong>yatırım danışmanlığı kapsamında değildir</strong>. Yatırım danışmanlığı hizmeti, kişilerin risk ve getiri tercihleri dikkate alınarak yalnızca yetkili kurumlar tarafından sunulmaktadır.</p>
      <p>Yatırım Danışmanlığı hizmeti; aracı kurumlar, portföy yönetim şirketleri, mevduat kabul etmeyen bankalar ile müşteri arasında imzalanacak Yatırım Danışmanlığı sözleşmesi çerçevesinde sunulmaktadır.</p>
      <p>Burada yer alan yorum ve tavsiyeler objektif olarak grafikler veya KAP haberlerine bağlı <strong>kişisel görüşlere dayanmakta olup</strong>, herhangi bir yatırım aracının alım-satım önerisi ya da getiri vaadi olarak yorumlanmamalıdır.</p>
      <p>Bu görüşler mali durumunuz ile risk ve getiri tercihlerinize uygun olmayabilir. Bu nedenle, sadece burada yer alan bilgilere dayanarak yatırım kararı verilmesi beklentilerinize uygun sonuçlar doğurmayabilir.</p>
      <p>Hiçbir şekilde yönlendirici nitelikte olmayan bu içerik, genel anlamda bilgi vermeyi amaçlamakta olup; bu içeriğin, müşterilerin ve diğer yatırımcıların alım satım kararlarını destekleyebilecek yeterli bilgileri kapsamayabileceği dikkate alınmalıdır. </p>
      <p>Bu sayfalarda yer alan çeşitli bilgi ve görüşlere dayanılarak yapılacak ileriye dönük yatırımlar ve ticari işlemlerin sonuçlarından ya da <strong>ortaya çıkabilecek zararlardan</strong> sitemiz ve site yetkilileri sorumlu tutulamaz.</p>
      <p>Sitemizde yer alan içeriğin tamamı veya herhangi bir kısmı yalnızca sahipleri tarafından veya sahiplerinin yazılı izni ile kullanılabilir. İçerik üzerinde izinsiz değişiklik yapmak, kopyalamak, kiralamak, ödünç vermek, iletmek ve yayınlamak yasaktır. Bu siteden alınan içerik herhangi bir ticari amaçla kullanılamaz.</p>
      <div class="modal-buttons">
        <button id="cancelModalBtn">İptal</button>
        <button id="acceptModalBtn">Onaylıyorum</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, Timestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { query, collection, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyADPBpJhZ9UKR1NFC42bqEqgKHyLaWunIQ",
      authDomain: "economentor-8ddc4.firebaseapp.com",
      projectId: "economentor-8ddc4",
      storageBucket: "economentor-8ddc4.firebasestorage.app",
      messagingSenderId: "835370350520",
      appId: "1:835370350520:web:d9bb275eb4b7502997814d",
      measurementId: "G-FS3FMPYVPD"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const form = document.getElementById("registerForm");
    const modal = document.getElementById("warningModal");
    const acceptBtn = document.getElementById("acceptModalBtn");
    const cancelBtn = document.getElementById("cancelModalBtn");
    let formSubmitted = false;
    
  acceptBtn.addEventListener("click", () => {
  modal.style.display = "none";    // Modal kapatılır
  formSubmitted = true;            // Kullanıcı onayladı olarak işaretlenir
  form.requestSubmit();            // Form yeniden gönderilir
});

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const errorBox = document.getElementById("errorMsg");
  const successBox = document.getElementById("successMsg");
  errorBox.innerText = "";
  successBox.innerText = "";

  const fullName = document.getElementById("fullName").value;
  const dob = document.getElementById("dob").value;
  const username = document.getElementById("username").value.trim();
  const usernameLower = username.toLowerCase();
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const confirmPassword = document.getElementById("confirmPassword").value;

  if (!formSubmitted) {
    modal.style.display = "flex";
    return;
  }

  if (password !== confirmPassword) {
    errorBox.innerText = "Şifreler uyuşmuyor!";
    errorBox.style.display = "block";
    return;
  }

  try {
    // Kullanıcı adı kontrolü
    const q = query(collection(db, "users"), where("username_lowercase", "==", usernameLower));
    const querySnapshot = await getDocs(q);

    if (!querySnapshot.empty) {
      errorBox.innerText = "Bu kullanıcı adı zaten alınmış. Lütfen başka bir kullanıcı adı seçin.";
      errorBox.style.display = "block";
      return;
    }

    // E-posta kontrolü (doğru yere taşındı!)
    const emailQuery = query(collection(db, "users"), where("email", "==", email));
    const emailSnapshot = await getDocs(emailQuery);

    if (!emailSnapshot.empty) {
      errorBox.innerText = "Bu e-posta adresi zaten kayıtlı.";
      errorBox.style.display = "block";
      return;
    }

    // Kayıt
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    await setDoc(doc(db, "users", user.uid), {
      fullName,
      dob,
      username,
      username_lowercase: usernameLower,
      email,
      registrationDate: Timestamp.fromDate(new Date()),
      role: "user"
    });

    successBox.innerText = "Kayıt başarılı! Giriş sayfasına yönlendiriliyorsunuz.";
    successBox.style.display = "block";

    setTimeout(() => {
      window.location.href = "index.html";
    }, 2000);

  } catch (error) {
    let message = "Bilinmeyen hata!";
    if (error.code === 'auth/email-already-in-use') {
      message = "Bu e-posta adresi zaten kullanımda.";
    } else if (error.code === 'auth/invalid-email') {
      message = "Geçersiz e-posta adresi.";
    } else if (error.code === 'auth/weak-password') {
      message = "Şifre çok zayıf.";
    }
    errorBox.innerText = message;
    errorBox.style.display = "block";
  }
});

const togglePassword = document.getElementById("togglePassword");
const passwordInput = document.getElementById("password");

togglePassword.addEventListener("click", () => {
  const isPassword = passwordInput.getAttribute("type") === "password";
  passwordInput.setAttribute("type", isPassword ? "text" : "password");

  togglePassword.classList.toggle("fa-eye-slash", !isPassword); // açıkken slash olmasın
  togglePassword.classList.toggle("fa-eye", isPassword);       // açıkken eye görünsün
});
  </script>
</body>
</html>

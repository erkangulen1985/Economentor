<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kullanıcı ve İstatistik Yönetimi</title>

    <!-- Favicon Ekleme -->
    <link rel="icon" type="image/png" href="image1.png" />

    <!-- Firebase SDK ve Chart.js bağlantıları -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f8;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #0052cc;
            color: white;
            padding: 20px;
            border-radius: 10px;
        }

        header h1 {
            font-size: 2rem;
        }

        .back-btn {
            background-color: #ff4b5c;
            border: none;
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .user-list {
            margin-top: 40px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        table th, table td {
            padding: 15px;
            text-align: left;
        }

        table th {
            background-color: #f4f6f8;
            font-weight: bold;
        }

        table tr:nth-child(even) {
            background-color: #f9fafb;
        }

        table tr:hover {
            background-color: #f1f1f1;
        }

        button.delete-btn {
            background-color: #ff4b5c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .chart-container {
            margin-top: 40px;
        }

        canvas {
            width: 100%;
            height: 300px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Kullanıcı ve İstatistik Yönetimi</h1>
            <button class="back-btn" onclick="window.location.href='adminpanel.html'">Geri</button>
        </header>

        <section class="stats">
            <div class="card">
                <h2>Kullanıcı Sayısı</h2>
                <p id="user-count">Yükleniyor...</p>
            </div>
            <div class="card">
                <h2>Dilek ve Şikayet Sayısı</h2>
                <p id="feedback-count">Yükleniyor...</p>
            </div>
            <div class="card">
                <h2>Analiz Sayısı</h2>
                <p id="analysis-count">Yükleniyor...</p>
            </div>
            <div class="card">
                <h2>Post Sayısı</h2>
                <p id="post-count">Yükleniyor...</p>
            </div>
        </section>

        <section class="user-list">
            <h2>Kullanıcı Bilgileri</h2>
            <table id="user-table">
                <thead>
                    <tr>
                        <th>Kullanıcı Adı</th>
                        <th>Ad Soyad</th>
                        <th>UID</th>
                        <th>Aksiyonlar</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Kullanıcılar burada listelenecek -->
                </tbody>
            </table>
        </section>

        <section class="charts">
            <h2>Son 10 Günün İstatistikleri</h2>
            <div class="chart-container">
                <canvas id="user-growth-chart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="likes-chart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="dislikes-chart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="comments-chart"></canvas>
            </div>
        </section>
    </div>

    <script>
        // Firebase config bilgilerinizi buraya ekleyin
        const firebaseConfig = {
            apiKey: "AIzaSyADPBpJhZ9UKR1NFC42bqEqgKHyLaWunIQ",
            authDomain: "economentor-8ddc4.firebaseapp.com",
            projectId: "economentor-8ddc4",
            storageBucket: "economentor-8ddc4.firebasestorage.app",
            messagingSenderId: "835370350520",
            appId: "1:835370350520:web:d9bb275eb4b7502997814d",
            measurementId: "G-FS3FMPYVPD"
        };

        // Firebase'i başlat
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const usersRef = db.collection('users');
        const feedbackRef = db.collection('feedback');
        const postsRef = db.collection('posts');
        const analysesRef = db.collection('analyses');

        // Kullanıcı sayısı ve diğer verileri çekme
        async function fetchStats() {
            const userCount = await usersRef.get();
            const feedbackCount = await feedbackRef.get();
            const postCount = await postsRef.get();
            const analysisCount = await analysesRef.get();

            document.getElementById('user-count').textContent = userCount.size;
            document.getElementById('feedback-count').textContent = feedbackCount.size;
            document.getElementById('post-count').textContent = postCount.size;
            document.getElementById('analysis-count').textContent = analysisCount.size;
        }

        // Kullanıcıları listeleme ve silme
        async function fetchUsers() {
            const usersSnapshot = await usersRef.get();
            const tableBody = document.querySelector('#user-table tbody');

            usersSnapshot.forEach(doc => {
                const user = doc.data();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.fullName}</td>
                    <td>${user.uid}</td>
                    <td><button class="delete-btn" onclick="deleteUser('${user.uid}')">Sil</button></td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Kullanıcıyı silme fonksiyonu
        async function deleteUser(uid) {
            await usersRef.doc(uid).delete();
            fetchUsers(); // Kullanıcı listesi güncelleniyor
        }

        // Grafik verilerini çekme ve çizme
        async function fetchChartData() {
            const chartData = {
                userGrowth: [],
                likes: [],
                dislikes: [],
                comments: [],
            };

            // Son 10 günün verilerini toplama (örnek veri çekme yöntemi)
            const currentDate = new Date();
            for (let i = 0; i < 10; i++) {
                const date = new Date(currentDate);
                date.setDate(date.getDate() - i);
                chartData.userGrowth.push([date.toISOString(), Math.floor(Math.random() * 100)]); // Örnek veri
                chartData.likes.push([date.toISOString(), Math.floor(Math.random() * 50)]);
                chartData.dislikes.push([date.toISOString(), Math.floor(Math.random() * 50)]);
                chartData.comments.push([date.toISOString(), Math.floor(Math.random() * 100)]);
            }

            renderCharts(chartData);
        }

        // Grafiklerin çizilmesi
        function renderCharts(data) {
            const userGrowthChart = new Chart(document.getElementById('user-growth-chart'), {
                type: 'line',
                data: {
                    labels: data.userGrowth.map(item => item[0]),
                    datasets: [{
                        label: 'Kullanıcı Sayısı',
                        data: data.userGrowth.map(item => item[1]),
                        borderColor: 'rgb(75, 192, 192)',
                        fill: false,
                    }]
                }
            });

            const likesChart = new Chart(document.getElementById('likes-chart'), {
                type: 'line',
                data: {
                    labels: data.likes.map(item => item[0]),
                    datasets: [{
                        label: 'Beğeniler',
                        data: data.likes.map(item => item[1]),
                        borderColor: 'rgb(255, 99, 132)',
                        fill: false,
                    }]
                }
            });

            const dislikesChart = new Chart(document.getElementById('dislikes-chart'), {
                type: 'line',
                data: {
                    labels: data.dislikes.map(item => item[0]),
                    datasets: [{
                        label: 'Beğenmemeler',
                        data: data.dislikes.map(item => item[1]),
                        borderColor: 'rgb(54, 162, 235)',
                        fill: false,
                    }]
                }
            });

            const commentsChart = new Chart(document.getElementById('comments-chart'), {
                type: 'line',
                data: {
                    labels: data.comments.map(item => item[0]),
                    datasets: [{
                        label: 'Yorumlar',
                        data: data.comments.map(item => item[1]),
                        borderColor: 'rgb(153, 102, 255)',
                        fill: false,
                    }]
                }
            });
        }

        // Sayfa yüklendiğinde verileri çek
        document.addEventListener('DOMContentLoaded', () => {
            fetchStats();
            fetchUsers();
            fetchChartData();
        });
    </script>
</body>
</html>

<!DOCTYPE html>  
<html lang="tr">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
  <title>Economentor | Giriş</title>  
  <link rel="icon" href="image1.png" />  
  <link rel="manifest" href="/manifest.json" />  
  <meta name="theme-color" content="#001f3d" />  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">  
  
  <style>  
    body {  
      margin: 0;  
      padding: 0;  
      background-color: #001f3d;  
      color: white;  
      font-family: Arial, sans-serif;  
      height: 100vh;  
      overflow: hidden;  
    }  
  
    .background {  
      position: absolute;  
      top: 0; left: 0; right: 0; bottom: 0;  
      background: url('image2.png') no-repeat center center;  
      background-size: cover;  
      z-index: -1;  
    }  
  
    .container {  
      position: relative;  
      top: 50%;  
      left: 50%;  
      transform: translate(-50%, -50%);  
      background: rgba(0, 0, 0, 0.7);  
      padding: 30px;  
      border-radius: 10px;  
      text-align: center;  
      width: 350px;  
    }  
  
    input, button {  
      width: 80%;  
      padding: 12px;  
      margin: 10px auto;  
      display: block;  
      font-size: 16px;  
      border-radius: 6px;  
    }  
  
    input {  
      border: none;  
      background: #fff;  
      color: #333;  
    }  
  
    button {  
      background: #4CAF50;  
      color: white;  
      border: none;  
      cursor: pointer;  
    }  
  
    .link {  
      display: block;  
      margin-top: 10px;  
      margin-bottom: 20px;  
      color: white;  
      font-size: 14px;  
      text-decoration: none;  
    }  
    .link:hover {  
      text-decoration: underline;  
    }  
  
    #installPrompt {  
      display: none;  
      position: fixed;  
      top: -200px;  
      left: 0;  
      right: 0;  
      background: #001f3d;  
      color: white;  
      padding: 15px;  
      text-align: center;  
      z-index: 9999;  
      transition: top 0.5s ease;  
    }  
  
    #installPrompt button {  
      margin-top: 10px;  
      background: #4CAF50;  
    }  
    form {  
      display: flex;  
      flex-direction: column;  
      align-items: center;  
      gap: 5px; /* Tüm öğeler arası eşit boşluk */  
    }  
  .eye-icon {  
  position: absolute;  
  right: 10px;  
  top: 50%;  
  transform: translateY(-50%);  
  cursor: pointer;  
  color: black;  
  padding: 5px;  
  border-radius: 50%;  
}  

.back-button {
  background: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 12px 20px;
  font-size: 16px;
  margin-top: 10px;
  cursor: pointer;
  transition: background 0.3s;
  width: 55%;
}

.back-button:hover {
  background: #0056b3;
}
  
@media screen and (max-width: 480px) {  
  .container {  
    width: 90% !important;  
    padding: 20px;  
    transform: translate(-50%, -50%);  
    left: 50%;  
    top: 50%;  
  }  
  
  input, button {  
    width: 90% !important;  
    max-width: 300px;  
    font-size: 15px;  
    margin-left: auto;  
    margin-right: auto;  
  }  
  
  h1 {  
    font-size: 22px;  
  }  
  
  .link {  
    font-size: 13px;  
  }  
  
  #installPrompt img {  
    width: 72px;  
    height: 72px;  
  }  
  .eye-icon {  
    right: 30px;  
    padding: 4px;  
  }  
  .back-button {
    width: 55% !important;
    font-size: 15px;
  }
}  
  
</style>  
  
</head>  
<body>  
  <div class="background"></div>  
  
  <div class="container">  
    <h1>ECONOMENTOR</h1>  
<form id="loginForm" style="width: 100%; max-width: 350px; margin: 0 auto;">  
  <input type="text" id="username" placeholder="Kullanıcı Adı" required  
         style="width: 100%; padding: 12px; margin-bottom: 10px;  
                font-size: 16px; border-radius: 6px; border: none;  
                background: #fff; color: #333; box-sizing: border-box;" />  
  
  <div style="position: relative; width: 100%;">  
    <input type="password" id="password" placeholder="Şifre" required  
           style="width: 100%; padding: 12px 40px 12px 12px;  
                  font-size: 16px; border-radius: 6px; border: none;  
                  background: #fff; color: #333; box-sizing: border-box;" />  
    <i id="togglePassword" class="fa-solid fa-eye-slash eye-icon"></i>  
  </div>  
      <button type="submit">Giriş Yap</button>  
      <button onclick="window.location.href='index.html'" class="back-button">Geri Dön</button>
      <div id="errorMsg" style="color: red;"></div>  
    </form>  
    <a class="link" href="şifremiunuttum.html">Şifremi Unuttum</a>  
    <a class="link" href="kullaniciadi.html">Kullanıcı Adımı Unuttum</a>  
    <a class="link" href="kayitol.html">Kayıt Ol</a>  
  </div>  
  
<div id="installPrompt">  
  <img src="https://economentor.netlify.app/image1.png" alt="Economentor icon" width="96" height="96" style="margin-bottom: 10px;">  
  <p>Bu uygulamayı yüklemek ister misiniz?</p>  
  <button id="installButton">Yükle</button>  
</div>  
  
  <script type="module">  
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";  
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";  
    import { getFirestore, collection, query, where, getDocs, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";  
  
    const firebaseConfig = {  
      apiKey: "AIzaSyADPBpJhZ9UKR1NFC42bqEqgKHyLaWunIQ",  
      authDomain: "economentor-8ddc4.firebaseapp.com",  
      projectId: "economentor-8ddc4",  
      storageBucket: "economentor-8ddc4.appspot.com",  
      messagingSenderId: "835370350520",  
      appId: "1:835370350520:web:d9bb275eb4b7502997814d"  
    };  
  
    const app = initializeApp(firebaseConfig);  
    const auth = getAuth(app);  
    const db = getFirestore(app);  
  
    document.getElementById("loginForm").addEventListener("submit", async (e) => {  
      e.preventDefault();  
      const username = document.getElementById("username").value.trim();  
      const password = document.getElementById("password").value;  
      const errorBox = document.getElementById("errorMsg");  
  
      try {  
        const q = query(collection(db, "users"), where("username", "==", username));  
        const snap = await getDocs(q);  
        if (snap.empty) {  
          errorBox.textContent = "Kullanıcı adı bulunamadı.";  
          return;  
        }  
  
        const userDoc = snap.docs[0];  
        const email = userDoc.data().email;  
        const role = userDoc.data().role || "user";  
  
        const cred = await signInWithEmailAndPassword(auth, email, password);  
        if (role === "admin") {  
          location.href = "duyuru.html";  
        } else {  
          location.href = "duyuru.html";  
        }  
      } catch (err) {  
        console.error(err);  
        errorBox.textContent = "Kullanıcı adı veya şifre hatalı!";  
      }  
    });  
  
    // ✅ Service Worker Kaydı  
if ('serviceWorker' in navigator) {  
  navigator.serviceWorker.register('/firebase-messaging-sw.js')  
    .then(reg => {  
      console.log("📲 firebase-messaging-sw.js başarıyla kaydedildi.");  
    })  
    .catch(err => {  
      console.error("❌ Servis Worker hatası:", err);  
    });  
}  

  // [firebase kodların zaten burada]

  // PWA yükleme kutusu gösterimi
  let isAppleDevice = /iphone|ipad|ipod|macintosh/.test(navigator.userAgent.toLowerCase());
  let isInStandalone = (window.matchMedia('(display-mode: standalone)').matches) || ('standalone' in window.navigator && window.navigator.standalone);
  let deferredPrompt = null;
  let installBoxShown = false;

  window.addEventListener("load", () => {
    if (isAppleDevice && !isInStandalone && !installBoxShown) {
      const promptBox = document.getElementById("installPrompt");
      promptBox.style.display = "block";
      setTimeout(() => {
        promptBox.style.top = "0";
      }, 300);
      installBoxShown = true;
    }
  });

  window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault();
    deferredPrompt = e;

    if (!installBoxShown) {
      const promptBox = document.getElementById("installPrompt");
      promptBox.style.display = "block";
      setTimeout(() => {
        promptBox.style.top = "0";
      }, 300);
      installBoxShown = true;
    }
  });

  document.getElementById("installButton").addEventListener("click", async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const result = await deferredPrompt.userChoice;
      deferredPrompt = null;
      document.getElementById("installPrompt").style.top = "-200px";
    } else if (isAppleDevice) {
      alert(`"Economentor" uygulamasını yüklemek için:\n\n1. Safari'de bu sayfayı açın.\n2. Alttaki paylaş (📤) simgesine dokunun.\n3. "Ana Ekrana Ekle" seçeneğini seçin.`);
      document.getElementById("installPrompt").style.top = "-200px";
    } else {
      alert("Tarayıcınız yüklemeyi desteklemiyor veya uygulama zaten yüklü.");
      document.getElementById("installPrompt").style.top = "-200px";
    }
  });

const togglePassword = document.getElementById("togglePassword");
const passwordInput = document.getElementById("password");

togglePassword.addEventListener("click", () => {
  const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
  passwordInput.setAttribute("type", type);

  // Simgeyi değiştir
  togglePassword.classList.toggle("fa-eye");
  togglePassword.classList.toggle("fa-eye-slash");
});

</script>
</body>  
</html> 
